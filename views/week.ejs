<%- include("header.ejs") %>
<% if (weatherData) { %>
  <%- include("form.ejs") %>
<% } %>

<div class="containor">
    <canvas id="temperatureChart" width="400" height="200" style="display: block;height: 300px;width: 899px;"></canvas>
    <script>
       //for canvas
  const weatherData = <%- JSON.stringify(weatherData) %>;
  const hourlyData = weatherData.list;
  
  // Extract dt_txt values for labels
  const hours = hourlyData.map(data => {
    // Split dt_txt to get the time part
    const timeParts = data.dt_txt.split(' ')[1].split(':');
    // Format the time as needed (assuming it's in 24-hour format already)
    return `${timeParts[0]}:${timeParts[1]}`;
  });
  
  const temperatures = hourlyData.map(data => data.main.temp);
  const windSpeeds = hourlyData.map(data => data.wind.speed);
  const precipitations = hourlyData.map(data => (data.rain && data.rain['3h']) ? data.rain['3h'] : 0);
  
  function createChart(hours, temperatures, windSpeeds, precipitations) {
    const ctx = document.getElementById('temperatureChart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: hours,
        datasets: [
          {
            label: 'Temperature (°C)',
            data: temperatures,
            borderColor: 'rgba(255, 0, 0, 1)', // Red color for temperature line
            borderWidth: 1,
            yAxisID: 'y-temp'
          },
          {
            label: 'Wind Speed (km/h)',
            data: windSpeeds,
            borderColor: 'rgba(0, 0, 255, 1)', // Blue color for wind speed line
            borderWidth: 1,
            yAxisID: 'y-wind'
          },
          {
            label: 'Precipitation (mm)',
            data: precipitations,
            borderColor: 'rgba(0, 255, 0, 1)', // Green color for precipitation line
            borderWidth: 1,
            yAxisID: 'y-precip'
          }
        ]
      },
      options: {
        scales: {
          yAxes: [
            {
              id: 'y-temp',
              type: 'linear',
              position: 'left',
              scaleLabel: {
                display: true,
                labelString: 'Temperature (°C)'
              },
              ticks: {
                beginAtZero: true
              }
            },
            {
              id: 'y-wind',
              type: 'linear',
              position: 'right',
              scaleLabel: {
                display: true,
                labelString: 'Wind Speed (km/h)'
              },
              ticks: {
                beginAtZero: true
              }
            },
            {
              id: 'y-precip',
              type: 'linear',
              position: 'right',
              scaleLabel: {
                display: true,
                labelString: 'Precipitation (mm)'
              },
              ticks: {
                beginAtZero: true
              }
            }
          ]
        }
      }
    });
  }
  
  createChart(hours, temperatures, windSpeeds, precipitations);
    </script>
</div>  

<%- include("footer.ejs") %>